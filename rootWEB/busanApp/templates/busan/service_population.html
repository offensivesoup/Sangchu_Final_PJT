<!-- your_template.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busan Map Chart</title>

    <!-- Google Charts API -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages':['geochart']});
        google.charts.setOnLoadCallback(drawRegionsMap);

        function drawRegionsMap() {
            // JSON 파일 경로
            var jsonData = "{% static 'busan_gu.json' %}";

            // AJAX를 사용하여 JSON 파일 로드
            var xhr = new XMLHttpRequest();
            xhr.open("GET", jsonData, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var guData = JSON.parse(xhr.responseText);

                    // 가공된 데이터를 담을 배열
                    var chartData = [['Gu', 'Category', 'Service Population']];

                    // 가상의 데이터 예시 (실제로는 서버에서 데이터를 가져와야 함)
                    var categoryData = {
                        '부산진구': {'음식': 500, '소매': 300, '과학기술': 200, '수리개인': 100},
                        '동래구': {'음식': 600, '소매': 400, '과학기술': 300, '수리개인': 150},
                        // ... 각 구에 대한 데이터 추가
                    };

                    // category와 service_population_per_service를 기반으로 가공
                    for (var gu in categoryData) {
                        for (var category in categoryData[gu]) {
                            var population = categoryData[gu][category];
                            chartData.push([gu, category, population]);
                        }
                    }

                    // 구글 차트에 데이터 전달
                    var chart = new google.visualization.GeoChart(document.getElementById('chart_div'));
                    chart.draw(google.visualization.arrayToDataTable(chartData), {
                        region: 'KR', // 대한민국 지도
                        displayMode: 'regions',
                        resolution: 'provinces',
                        colors: ['green', 'blue', 'yellow', 'red'], // 각 카테고리에 대한 색상 지정
                        legend: 'none',
                        sizeAxis: {minValue: 0, maxValue: 600}, // 색상 범위 지정
                        colorAxis: {colors: ['green', 'blue', 'yellow', 'red']} // 색상 범위에 따라 구글 차트에서 사용할 색상 지정
                    });
                }
            };
            xhr.send();
        }
    </script>
</head>
<body>
    <!-- 구글 차트를 나타낼 div -->
    <div id="chart_div" style="width: 100%; height: 500px;"></div>
</body>
</html>